# Sending payments

Once the SDK is initialized, you can directly begin sending payments. The send process takes two steps:
1. [Preparing the Payment](send_payment.md#preparing-payments)
1. [Sending the Payment](send_payment.md#sending-payments-1)

<div class="warning">
<h4>Developer note</h4>
Consider implementing the <a href="/notifications/getting_started.md">Notification Plugin</a> when using the Breez SDK in a mobile application. By registering a webhook the application can receive notifications to process the payment in the background.
</div>

<h2 id="preparing-payments">
    <a class="header" href="#preparing-payments">Preparing Payments</a>
    <a class="tag" target="_blank" href="https://breez.github.io/breez-sdk-liquid/breez_sdk_liquid/sdk/struct.LiquidSdk.html#method.prepare_send_payment">API docs</a>
</h2>

During the prepare step, the SDK ensures that the inputs are valid with respect to the destination,
and also returns the relative fees related to the payment so they can be confirmed. 

The `destination` field of the payment request supports Liquid BIP21, Liquid addresses and Lightning invoices

### Lightning
Two types of Lightning destinations are possible: BOLT11 invoices and BOLT12 offers.

For BOLT11 invoices, the amount **must** be set. If the optional prepare request amount is also set, the SDK will make sure the two values match, else an error will be thrown. 

The SDK will also validate that the amount is within the send lightning limits of the swap service.

<custom-tabs category="lang">
<div slot="title">Rust</div>
<section>

```rust,ignore
{{#include ../../snippets/rust/src/send_payment.rs:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Swift</div>
<section>

```swift,ignore
{{#include ../../snippets/swift/BreezSDKExamples/Sources/SendPayment.swift:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Kotlin</div>
<section>

```kotlin,ignore
{{#include ../../snippets/kotlin_mpp_lib/shared/src/commonMain/kotlin/com/example/kotlinmpplib/SendPayment.kt:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Javascript</div>
<section>

```typescript
{{#include ../../snippets/wasm/send_payment.ts:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">React Native</div>
<section>

```typescript
{{#include ../../snippets/react-native/send_payment.ts:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Dart</div>
<section>

```dart,ignore
{{#include ../../snippets/dart_snippets/lib/send_payment.dart:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Python</div>
<section>

```python,ignore 
{{#include ../../snippets/python/src/send_payment.py:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">Go</div>
<section>

```go,ignore
{{#include ../../snippets/go/send_payment.go:prepare-send-payment-lightning-bolt11}}
```
</section>

<div slot="title">C#</div>
<section>

```cs,ignore
{{#include ../../snippets/csharp/SendPayment.cs:prepare-send-payment-lightning-bolt11}}
```
</section>
</custom-tabs>

Payments to a BOLT12 offer can be done in a similar way. However, when paying to a BOLT12 offer, the SDK's prepare request **must** include an amount.

<custom-tabs category="lang">
<div slot="title">Rust</div>
<section>

```rust,ignore
{{#include ../../snippets/rust/src/send_payment.rs:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Swift</div>
<section>

```swift,ignore
{{#include ../../snippets/swift/BreezSDKExamples/Sources/SendPayment.swift:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Kotlin</div>
<section>

```kotlin,ignore
{{#include ../../snippets/kotlin_mpp_lib/shared/src/commonMain/kotlin/com/example/kotlinmpplib/SendPayment.kt:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Javascript</div>
<section>

```typescript
{{#include ../../snippets/wasm/send_payment.ts:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">React Native</div>
<section>

```typescript
{{#include ../../snippets/react-native/send_payment.ts:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Dart</div>
<section>

```dart,ignore
{{#include ../../snippets/dart_snippets/lib/send_payment.dart:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Python</div>
<section>

```python,ignore 
{{#include ../../snippets/python/src/send_payment.py:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">Go</div>
<section>

```go,ignore
{{#include ../../snippets/go/send_payment.go:prepare-send-payment-lightning-bolt12}}
```
</section>

<div slot="title">C#</div>
<section>

```cs,ignore
{{#include ../../snippets/csharp/SendPayment.cs:prepare-send-payment-lightning-bolt12}}
```
</section>
</custom-tabs>

<div class="warning">
<h4>Developer note</h4>
When paying an invoice generated by another Liquid SDK instance, or any other application which uses the Boltz swapper internally, the payment will fall back to a direct onchain payment. 
The advantage of this is the payer will spend less on fees, as they are no longer relying on external services to execute the payment. 
Note that this also means a <a target="_blank" href="{{api_key_form_uri}}">Breez API key</a> <b>will be required</b> in order for the payment to be executed. 
To learn more about this process and how it works in detail, see the Boltz documentation for  <a target="_blank" href="https://docs.boltz.exchange/v/api/magic-routing-hints">Magic Routing Hints (MRH)</a>.
</div>

### Bitcoin

For onchain (Bitcoin) payments, see [Sending an on-chain transaction](pay_onchain.md).

### Liquid
When sending via Liquid, a BIP21 URI or Liquid address can be used as the destination. 

If a Liquid address is used, the optional prepare request amount **must** be set. 

If a BIP21 URI is used, either the BIP21 URI amount or optional prepare request amount **must** be set. When both amounts are set, the SDK will prioritize the **request amount** over the BIP21 amount.

**Note:** If a valid Breez API key is not provided, the method will throw an error requiring you to specify one.

<div class="warning">
<h4>Developer note</h4>
To send non-Bitcoin assets, see <a href="assets.md#sending-a-non-bitcoin-asset">Handling multiple assets</a>.
</div>

#### Setting the receiver amount
When you want the payment receipient to receive a specific amount.

<custom-tabs category="lang">
<div slot="title">Rust</div>
<section>

```rust,ignore
{{#include ../../snippets/rust/src/send_payment.rs:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Swift</div>
<section>

```swift,ignore
{{#include ../../snippets/swift/BreezSDKExamples/Sources/SendPayment.swift:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Kotlin</div>
<section>

```kotlin,ignore
{{#include ../../snippets/kotlin_mpp_lib/shared/src/commonMain/kotlin/com/example/kotlinmpplib/SendPayment.kt:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Javascript</div>
<section>

```typescript
{{#include ../../snippets/wasm/send_payment.ts:prepare-send-payment-liquid}}
```
</section>

<div slot="title">React Native</div>
<section>

```typescript
{{#include ../../snippets/react-native/send_payment.ts:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Dart</div>
<section>

```dart,ignore
{{#include ../../snippets/dart_snippets/lib/send_payment.dart:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Python</div>
<section>

```python,ignore 
{{#include ../../snippets/python/src/send_payment.py:prepare-send-payment-liquid}}
```
</section>

<div slot="title">Go</div>
<section>

```go,ignore
{{#include ../../snippets/go/send_payment.go:prepare-send-payment-liquid}}
```
</section>

<div slot="title">C#</div>
<section>

```cs,ignore
{{#include ../../snippets/csharp/SendPayment.cs:prepare-send-payment-liquid}}
```
</section>
</custom-tabs>

#### Draining all funds
When you want send all funds from your wallet to another address.

<custom-tabs category="lang">
<div slot="title">Rust</div>
<section>

```rust,ignore
{{#include ../../snippets/rust/src/send_payment.rs:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Swift</div>
<section>

```swift,ignore
{{#include ../../snippets/swift/BreezSDKExamples/Sources/SendPayment.swift:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Kotlin</div>
<section>

```kotlin,ignore
{{#include ../../snippets/kotlin_mpp_lib/shared/src/commonMain/kotlin/com/example/kotlinmpplib/SendPayment.kt:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Javascript</div>
<section>

```typescript
{{#include ../../snippets/wasm/send_payment.ts:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">React Native</div>
<section>

```typescript
{{#include ../../snippets/react-native/send_payment.ts:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Dart</div>
<section>

```dart,ignore
{{#include ../../snippets/dart_snippets/lib/send_payment.dart:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Python</div>
<section>

```python,ignore 
{{#include ../../snippets/python/src/send_payment.py:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">Go</div>
<section>

```go,ignore
{{#include ../../snippets/go/send_payment.go:prepare-send-payment-liquid-drain}}
```
</section>

<div slot="title">C#</div>
<section>

```cs,ignore
{{#include ../../snippets/csharp/SendPayment.cs:prepare-send-payment-liquid-drain}}
```
</section>
</custom-tabs>

<h2 id="sending-payments">
    <a class="header" href="#sending-payments">Sending Payments</a>
    <a class="tag" target="_blank" href="https://breez.github.io/breez-sdk-liquid/breez_sdk_liquid/sdk/struct.LiquidSdk.html#method.send_payment">API docs</a>
</h2>

Once the payment has been prepared, all you have to do is pass the prepare response as an argument to the
send method.

<custom-tabs category="lang">
<div slot="title">Rust</div>
<section>

```rust,ignore
{{#include ../../snippets/rust/src/send_payment.rs:send-payment}}
```
</section>

<div slot="title">Swift</div>
<section>

```swift,ignore
{{#include ../../snippets/swift/BreezSDKExamples/Sources/SendPayment.swift:send-payment}}
```
</section>

<div slot="title">Kotlin</div>
<section>

```kotlin,ignore
{{#include ../../snippets/kotlin_mpp_lib/shared/src/commonMain/kotlin/com/example/kotlinmpplib/SendPayment.kt:send-payment}}
```
</section>

<div slot="title">Javascript</div>
<section>

```typescript
{{#include ../../snippets/wasm/send_payment.ts:send-payment}}
```
</section>

<div slot="title">React Native</div>
<section>

```typescript
{{#include ../../snippets/react-native/send_payment.ts:send-payment}}
```
</section>

<div slot="title">Dart</div>
<section>

```dart,ignore
{{#include ../../snippets/dart_snippets/lib/send_payment.dart:send-payment}}
```
</section>

<div slot="title">Python</div>
<section>

```python,ignore 
{{#include ../../snippets/python/src/send_payment.py:send-payment}}
```
</section>

<div slot="title">Go</div>
<section>

```go,ignore
{{#include ../../snippets/go/send_payment.go:send-payment}}
```
</section>

<div slot="title">C#</div>
<section>

```cs,ignore
{{#include ../../snippets/csharp/SendPayment.cs:send-payment}}
```
</section>
</custom-tabs>

## Event Flows
Once a send payment is initiated, you can follow and react to the different payment events using the guide below for each payment method. See [Listening to events](/guide/events.html) for how to subscribe to events.

### Lightning
| Event | Description | UX Suggestion |
| --- | --- | --- |
| **PaymentPending** | The SDK has broadcast the lockup transaction for the swap. | Show payment as pending. |
| **PaymentWaitingConfirmation** | If the Lightning invoice contains an <a target="_blank" href="https://docs.boltz.exchange/v/api/magic-routing-hints">MRH</a>, the SDK will instead broadcast a direct Liquid transaction. | Display successful payment feedback. |
| **PaymentSucceeded** | The swap service has seen the lockup transaction and broadcast the claim transaction, or the direct Liquid transaction (<a target="_blank" href="https://docs.boltz.exchange/v/api/magic-routing-hints">MRH</a>) is confirmed. | Show payment as complete. |
| **PaymentFailed** | The swap has expired without a lockup transaction. |  |
| **PaymentRefundPending** | The swap can be refunded for several reasons. Either the swap/invoice has expired or the swap service failed to pay the invoice. In this case the SDK will broadcast a refund transaction. |  |
| **PaymentRefunded** | The refund transaction is confirmed. |  |

### Bitcoin
| Event | Description | UX Suggestion |
| --- | --- | --- |
| **PaymentPending** | The SDK has broadcast the Liquid lockup transaction. Once the SDK has seen the Bitcoin lockup transaction, it will broadcast the Bitcoin claim transaction, either when the Bitcoin lockup transaction is confirmed or immediately if it is accepted as a zero-conf payment. | Show payment as pending. |
| **PaymentWaitingConfirmation** | The Bitcoin claim transaction has been broadcast and is waiting confirmation. | Display successful payment feedback. |
| **PaymentSucceeded** | The Bitcoin claim transaction is confirmed. | Show payment as complete. |
| **PaymentFailed** | The swap has expired without a Liquid lockup transaction. |  |
| **PaymentRefundPending** | The swap can be refunded for several reasons. Either the swap has expired or the Bitcoin lockup transaction failed to broadcast. In this case the SDK will broadcast a Liquid refund transaction. |  |
| **PaymentRefunded** | The Liquid refund transaction is confirmed. |  |

### Liquid
| Event | Description | UX Suggestion |
| --- | --- | --- |
| **PaymentWaitingConfirmation** | The transaction has been seen. | Display successful payment feedback. |
| **PaymentSucceeded** | The transaction is confirmed. | Show payment as complete. |
